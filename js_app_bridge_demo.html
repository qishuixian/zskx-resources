<!DOCTYPE html>
<html lang="en">
<head>
  <title>Test Web</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <script src="https://raw.githubusercontent.com/github/fetch/master/fetch.js"></script>

  <script>
    function printCookies() {
      console.log(document.cookie);
      alert(document.cookie);
    };

    function fetchUserFromNative() {
      // Android
      try {
        var user = window.appInfoDispose.getUser();
        alert(user);
        return;
      } catch (e) {
        console.log('Call Android Exception : ' + e.toString());
      }
      // iOS8+
      try {
        // 在receiveIOSCallback中获取调用结果
        window.webkit.messageHandlers.getUser.postMessage(null);
        return;
      } catch (e) {
        console.log('Call iOS Exception : ' + e.toString());
      }
    };

    function receiveIOSCallback(msgHandler, response) {
      if (msgHandler == 'getUser') {
        console.log(response);
        alert('user.name = ' + response.name);
      }
    };

    function _serverRequestError(statusCode) {
        var errorStr = '';
        if (statusCode === 400) {
            errorStr = '服务器无法解析请求';
        } else if (statusCode === 401) {
            errorStr = '请先登录授权';
        } else if (statusCode === 403) {
            errorStr = '服务器拒绝请求';
        } else if (statusCode === 404) {
            errorStr = '服务器未找到请求页';
        } else if (statusCode === 500) {
            errorStr = '服务器遇到错误，无法完成请求';
        } else if (statusCode === 501) {
            errorStr = '服务器不支持所请求的功能';
        } else if (statusCode === 502) {
            errorStr = '服务器从上游服务器收到一个无效的响应';
        } else if (statusCode === 503) {
            errorStr = '服务器繁忙';
        } else if (statusCode === 504) {
            errorStr = '网关超时';
        } else if (statusCode === 455) {
            errorStr = '版本过低';
        }
        return statusCode.toString() + " " + errorStr;
    };

    function fetchStoreInfoAPI() {
        var apiUrl = 'http://store.51dinghuo.cc/api/store/info';

        fetch(apiUrl, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'laimi-client-version': 'ios.store.client:2.20.0',
            },
            credentials: 'same-origin'
        })
        .then(function(response) {
            if (response.ok) {
                return response.json();
            } else {
                var error = new Error(_serverRequestError(response.status));
                throw error;
            }
        })
        .then(function(responseData) {
            console.log(JSON.stringify(responseData));
            alert(JSON.stringify(responseData));
        })
        .catch(function(error) {
            console.log(error.message);
            alert(error.message);
        });
    };

  </script>

</head>
<body>
<ul>
  <li><a href="https://m.jd.com/">京东H5</a></li>
  <li><a href="tel:18475555555">拨打电话</a></li>
  <li><a href="fmcgshop://goods/1600488">商品详情 (goodsId=1600488)</a></li>
  <li><a href="fmcgshop://activity/11143">活动商品列表 (activityId=11143)</a></li>
  <li><button onclick="fetchUserFromNative()">call getUser</button></li>
  <li><button onclick="printCookies()">print cookies</button></li>
  <li><button onclick="fetchStoreInfoAPI()">fetchStoreInfoAPI</button></li>
</ul>
</body>
</html>
