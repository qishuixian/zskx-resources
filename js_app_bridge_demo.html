<!DOCTYPE html>
<html lang="en">
<head>
    <title>Test Web</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script src="https://raw.githubusercontent.com/github/fetch/master/fetch.js"></script>

    <script>
    function printCookies() {
      console.log(document.cookie);
      alert(document.cookie);
    };

    // 加入购物车
    function addToCart(goodsInfo){
      // Android
      try {
        window.appDispose.addToCart(goodsInfo);
        return;
      } catch (e) {
        console.log('Call Android Exception : ' + e.toString());
      }
      // iOS8+
      try {
        window.webkit.messageHandlers.addToCart.postMessage(goodsInfo);
        return;
      } catch (e) {
        console.log('Call iOS Exception : ' + e.toString());
      }
    };

    // 添加套装到购物车
    function addBundleToCart(){
      let bundleInfo = '{"bundleId":6326230515036721153, "activityId":6326230515019943936}'
      this.addToCart(bundleInfo);
    }

    //  添加商品购物车
    function addGoodsToCart(){
      let goodsInfo = '{"goodsId":330614780, "isPresell":false}'
      this.addToCart(goodsInfo);
    }

    function fetchShareFromNative(shareInfo) {
       // Android
      try {
        // 在receiveAppCallback中获取调用结果
        window.appDispose.setShareInfo(shareInfo);
        return;
      } catch (e) {
        console.log('Call Android Exception : ' + e.toString());
      }
      // iOS8+
      try {
        // 在receiveAppCallback中获取调用结果
        window.webkit.messageHandlers.setShareInfo.postMessage(shareInfo);
        return;
      } catch (e) {
        console.log('Call iOS Exception : ' + e.toString());
      }
    };

    function fetchShareWebpageFromNative() {
      let webpageInfo = '{"title":"我是标题","description":"我是描述","webpageUrl":"https://www.zskuaixiao.com","webpageThumb":"http://www.wenphoto.com/uploads/article/20150815/caa8967c66ed5d943015fcd222dd7b23.jpg" }'
      this.fetchShareFromNative(webpageInfo);
    };

    function fetchShareTextFromNative() {
      let textInfo = '{"title":"我是标题哈哈哈哈哈哈哈哈哈哈有毒哈哈哈哈呃"}';
      this.fetchShareFromNative(textInfo);
    };

    function fetchShareImageFromNative() {
      let imageInfo = '{"image": "http://www.wenphoto.com/uploads/article/20150815/caa8967c66ed5d943015fcd222dd7b23.jpg"}';
      this.fetchShareFromNative(imageInfo);
    };

    function fetchUserFromNative() {
      // Android
      try {
        // 在receiveAppCallback中获取调用结果
        window.appDispose.getUser();
        return;
      } catch (e) {
        console.log('Call Android Exception : ' + e.toString());
      }
      // iOS8+
      try {
        // 在receiveAppCallback中获取调用结果
        window.webkit.messageHandlers.getUser.postMessage(null);
        return;
      } catch (e) {
        console.log('Call iOS Exception : ' + e.toString());
      }
    };

    function receiveAppCallback(platform, msgHandler, response) {
      console.log('回调平台：'+ platform);
      console.log(response);
      if (msgHandler == 'getUser') {
        alert('user.name = ' + response.name);
      } else if (msgHandler == 'setShareInfo') {
        alert('share resule = ' + response.shareResult);
      }
    };

    function _serverRequestError(statusCode) {
        var errorStr = '';
        if (statusCode === 400) {
            errorStr = '服务器无法解析请求';
        } else if (statusCode === 401) {
            errorStr = '请先登录授权';
        } else if (statusCode === 403) {
            errorStr = '服务器拒绝请求';
        } else if (statusCode === 404) {
            errorStr = '服务器未找到请求页';
        } else if (statusCode === 500) {
            errorStr = '服务器遇到错误，无法完成请求';
        } else if (statusCode === 501) {
            errorStr = '服务器不支持所请求的功能';
        } else if (statusCode === 502) {
            errorStr = '服务器从上游服务器收到一个无效的响应';
        } else if (statusCode === 503) {
            errorStr = '服务器繁忙';
        } else if (statusCode === 504) {
            errorStr = '网关超时';
        } else if (statusCode === 455) {
            errorStr = '版本过低';
        }
        return statusCode.toString() + " " + errorStr;
    };

    function fetchStoreInfoAPI() {
        var apiUrl = 'http://store.51dinghuo.cc/api/store/info';

        fetch(apiUrl, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'laimi-client-version': 'ios.store.client:2.20.0',
            },
            credentials: 'same-origin'
        })
        .then(function(response) {
            if (response.ok) {
                return response.json();
            } else {
                var error = new Error(_serverRequestError(response.status));
                throw error;
            }
        })
        .then(function(responseData) {
            console.log(JSON.stringify(responseData));
            alert(JSON.stringify(responseData));
        })
        .catch(function(error) {
            console.log(error.message);
            alert(error.message);
        });
    };

  </script>

</head>
<body>
<ul>
    <li><a href="https://m.jd.com/">京东H5</a></li>
    <li><a href="tel:18475555555">拨打电话</a></li>
    <li><a href="fmcgshop://goods/1600488">商品详情 (goodsId=1600488)</a></li>
    <li><a href="fmcgshop://activity/11143">活动商品列表 (activityId=11143)</a></li>
    <li><button onclick="fetchUserFromNative()">call getUser</button></li>
    <li><button onclick="fetchShareWebpageFromNative()">setWebpageShareInfo</button></li>
    <li><button onclick="fetchShareTextFromNative()">setTextShareInfo</button></li>
    <li><button onclick="fetchShareImageFromNative()">setImageShareInfo</button></li>
    <li><button onclick="printCookies()">print cookies</button></li>
    <li><button onclick="fetchStoreInfoAPI()">fetchStoreInfoAPI</button></li>
    <li><button onclick="addBundleToCart()">添加套装</button></li>
    <li><button onclick="addGoodsToCart()">添加商品</button></li>
</ul>
</body>
</html>
